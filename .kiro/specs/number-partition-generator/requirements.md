# 数字划分生成器功能需求文档

## 功能概述

为Rauzy分形工作台添加一个数字划分生成器功能，允许用户输入一个正整数r，系统自动生成该数字基于{1,2,3}的所有可能划分组合，并一键添加到路径列表中。

## 需求详述

### 需求1：数字划分输入界面

**用户故事：** 作为研究者，我希望能够输入一个正整数r，让系统自动生成所有可能的路径组合，这样我就不需要手动枚举所有可能的划分。

#### 验收标准
1. WHEN 用户在控制面板中看到数字划分输入区域 THEN 系统应该显示一个数字输入框和生成按钮
2. WHEN 用户输入一个正整数r（1 ≤ r ≤ 20） THEN 系统应该接受该输入
3. WHEN 用户输入无效数字（如0、负数、非整数、大于20） THEN 系统应该显示相应的错误提示
4. WHEN 用户输入为空或包含非数字字符 THEN 系统应该显示格式错误提示

### 需求2：数字划分算法实现

**用户故事：** 作为系统，我需要能够将给定的正整数r分解为所有可能的{1,2,3}组合，以便为用户提供完整的路径集合。

#### 验收标准
1. WHEN 系统接收到数字r THEN 系统应该生成所有满足 l₁ + l₂ + ... + lₚ = r 的序列组合，其中每个lᵢ ∈ {1,2,3}
2. WHEN r=3 THEN 系统应该生成：[3], [1,2], [2,1], [1,1,1]
3. WHEN r=4 THEN 系统应该生成：[1,3], [3,1], [2,2], [1,1,2], [1,2,1], [2,1,1], [1,1,1,1]
4. WHEN r=5 THEN 系统应该生成所有15种可能的组合
5. WHEN 生成的组合数量超过50个 THEN 系统应该显示警告并询问用户是否继续

### 需求3：批量路径添加功能

**用户故事：** 作为研究者，我希望能够一键将所有生成的路径组合添加到路径列表中，这样我就可以同时分析多个相关的路径。

#### 验收标准
1. WHEN 用户点击"生成并添加路径"按钮 THEN 系统应该将所有生成的路径组合添加到现有路径列表中
2. WHEN 添加路径时发现重复路径 THEN 系统应该跳过重复项并显示跳过数量
3. WHEN 路径总数超过系统限制（如100个） THEN 系统应该显示警告并允许用户选择是否继续
4. WHEN 批量添加完成 THEN 系统应该显示成功消息，包含添加的路径数量

### 需求4：预览和选择功能

**用户故事：** 作为研究者，我希望在添加路径之前能够预览所有生成的组合，并选择性地添加感兴趣的路径。

#### 验收标准
1. WHEN 用户输入数字r并点击"预览"按钮 THEN 系统应该显示所有可能的路径组合列表
2. WHEN 预览列表显示时 THEN 每个路径应该显示为可选择的复选框项
3. WHEN 用户选择部分路径并点击"添加选中路径" THEN 系统应该只添加选中的路径
4. WHEN 预览列表中的路径数量很多时 THEN 系统应该提供搜索和过滤功能

### 需求5：数学理论支持

**用户故事：** 作为研究者，我希望了解每个r值对应的划分数量的数学规律，以便更好地理解组合的复杂性。

#### 验收标准
1. WHEN 用户输入数字r THEN 系统应该显示该数字的理论划分数量
2. WHEN 系统生成划分时 THEN 应该按照字典序或权重顺序排列
3. WHEN 显示划分结果时 THEN 系统应该显示每个路径的总权重验证（应该等于r）
4. WHEN 用户悬停在路径上时 THEN 系统应该显示该路径的基本信息（长度、权重等）

### 需求6：性能和用户体验

**用户故事：** 作为用户，我希望数字划分生成过程快速且响应良好，即使处理较大的数字时也不会阻塞界面。

#### 验收标准
1. WHEN 生成划分数量较多时（>100个组合） THEN 系统应该显示进度指示器
2. WHEN 生成过程超过2秒 THEN 系统应该提供取消操作选项
3. WHEN 用户在生成过程中进行其他操作 THEN 界面应该保持响应
4. WHEN 生成完成 THEN 系统应该提供生成时间和组合数量的统计信息

## 技术约束

1. 输入数字r的范围限制在1-20之间，以避免组合爆炸
2. 生成的路径必须符合现有的路径格式要求
3. 批量添加操作必须与现有的路径管理系统兼容
4. 界面组件应该与现有的设计风格保持一致

## 验收测试场景

### 场景1：基本功能测试
- 输入r=3，验证生成4个正确的路径组合
- 输入r=4，验证生成7个正确的路径组合
- 输入r=5，验证生成15个正确的路径组合

### 场景2：边界条件测试
- 输入r=1，验证生成1个路径[1]
- 输入r=20，验证系统能够处理大量组合
- 输入无效值，验证错误处理

### 场景3：集成测试
- 生成路径后验证它们能够正确显示在路径列表中
- 验证生成的路径能够正确计算和渲染分形
- 验证批量操作不会影响现有路径的功能

## 优先级

- P0（必须）：基本的数字划分算法和路径生成
- P1（重要）：批量添加和重复检测
- P2（有用）：预览和选择功能
- P3（可选）：数学理论展示和性能优化